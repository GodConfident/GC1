$(document).ready(function(){$("#btnReply").click(function(){reply()});$("#btnModifyReply").click(function(){modifyReply()})});function reply(){if($("#btnReply").attr("disabled")=="disabled")return;$("#btnReply").addClass("disable").attr({disabled:true});jsonStr="\{postID:\""+$("#postid").val()+"\",parentPostID:\""+$("#parentPostID").val()+"\",ppID:\"0\", replyContent:\""+escape(UE.getEditor('myEditor').getContent())+"\"\}";$.ajax({type:"POST",url:"/quan/postReply.aspx/PostReply",contentType:"application/json; charset=utf-8",dataType:"json",data:jsonStr,cache:false,success:function(msg){$("#btnReply").removeClass("disable").attr({disabled:false});if(eval('('+msg.d+')')[0].d=='回复成功'){$("#replyMessage").text("回复成功");UE.getEditor('myEditor').setContent('',false);LoadData()}else{if(eval('('+msg.d+')')[0].d.indexOf("验证手机")>=0){popWin.showWin("310","255","验证手机","/quan/verifymobile.aspx")}else if(eval('('+msg.d+')')[0].d.indexOf("头像")>=0){ShowMessage(eval('('+msg.d+')')[0].d);window.setTimeout("location.href = '/user/editavatar'",3000)}else $("#replyMessage").text(eval('('+msg.d+')')[0].d)}}})}function modifyReply(){$("#btnModifyReply").addClass("disable").attr({disabled:true});jsonStr="\{rID:\""+$("#rid").val()+"\", replyContent:\""+escape(UE.getEditor('myEditor').getContent())+"\"\}";$.ajax({type:"POST",url:"/quan/postReply.aspx/ModifyReply",contentType:"application/json; charset=utf-8",dataType:"json",data:jsonStr,cache:false,success:function(msg){location.replace(msg.d)}})}function LoadData(){$("<div/>").load("/quan/GetAjaxData.aspx",{"postid":$("#postid").val(),"type":"getreply"},function(){}).appendTo($("#LoadArticleReply"))}function goanswer(){obj=document.getElementById("divanswer");if(obj){location.replace('#divanswer');UE.getEditor('myEditor').focus()}else{ShowMessage("请登录后回复")}}function replyVote(postid,typeid){$.ajax({type:"POST",url:"/quan/postReply.aspx",data:"postid="+postid+"&type=replyVote&typeid="+typeid,success:function(msg){if(msg.indexOf("您")>=0){ShowMessage(msg)}else{if(typeid==1){$("#agree"+postid).text('有用('+msg+')');$("#agree"+postid).removeAttr("href");$("#agree"+postid).css({"position":"relative"});$("#agree"+postid).append("<span class='flower'></span>");$("#agree"+postid).find(".flower").css({"position":"absolute","text-align":"center","left":"6px","top":"-10px","display":"block","width":"30px","height":"30px","background":"url(http://img.ithome.com/file/images/agree.gif) left center no-repeat","opacity":"0"}).animate({top:'-30px',opacity:'1'},300,function(){$(this).delay(300).animate({top:'-35px',opacity:'0'},300)});$("#agree"+postid).find(".flower").removeClass()}else{$("#against"+postid).text('没用('+msg+')');$("#against"+postid).removeAttr("href");$("#against"+postid).css({"position":"relative"});$("#against"+postid).append("<span class='shit'></span>");$("#against"+postid).find(".shit").css({"position":"absolute","text-align":"center","left":"6px","top":"-60px","display":"block","width":"30px","height":"30px","background":"url(http://img.ithome.com/file/images/against.gif) left center no-repeat","opacity":"0"}).animate({top:'-30px',opacity:'1'},300,function(){$(this).delay(300).animate({top:'-5px',opacity:'0'},300)});$("#against"+postid).find(".shit").removeClass()}}}})}function pagereply(page,commentcount,ordertext){var order;var insertObj=$("#ulcommentlist");if(ordertext=='正序显示'){order='order';insertObj=$("#ulcommentlistorder")}var new_item=$("<div/>").load("/quan/GetAjaxData.aspx",{"postid":$("#postid").val(),"type":"replypage","page":page,"order":order},function(){$("img.lazy").lazyload()}).hide();insertObj.append(new_item);new_item.fadeIn("slow");if(page*25>commentcount)$(".more_comm").hide()}function delReply(rid){if(confirm("确定要删除这个回复？")){$.ajax({type:"POST",url:"/quan/postop.aspx",data:"rid="+rid+"&type=delreply",success:function(msg){if(msg.indexOf("/")>=0){$("#ulcommentlist #reply"+rid).remove()}else{ShowMessage(msg)}}})}}$(document).ready(function(){});function moveEnd(obj){obj.focus();var len=obj.value.length;if(document.selection){var sel=obj.createTextRange();sel.moveStart('character',len);sel.collapse();sel.select()}else if(typeof obj.selectionStart=='number'&&typeof obj.selectionEnd=='number'){obj.selectionStart=obj.selectionEnd=len}}var addModel=function(titlename,con){scoll=$(window).scrollTop();$(".bbsmodal").remove();var modal_s1="<div class='bbsmodal'><h4>"+titlename+"<span class='closebtn'></span></h4>",modal_s2="</div>";$("body").append(modal_s1+con+modal_s2);$(".bbsmodal").show().css({top:"200px"})};var dataTime=function(){var d=new Date,vYear=d.getFullYear(),vMon=d.getMonth()+1,vDay=d.getDate(),h=d.getHours(),m=d.getMinutes(),s=d.getSeconds(),time=vYear+'-'+vMon+'-'+vDay+' '+h+":"+m+":"+s;return time};var closeClick=function(){$("body").delegate(".bbsmodal .closebtn","click",function(e){e.preventDefault();$(".bbsmodal").remove()})};var oremarkbtn="";$(".comm_list").delegate(".reply_btn","click",function(){oremarkbtn=$(this);modelreplyComment();addReply();$(".bbsmodal textarea").keydown(function(e){if((e.which===13||e.which===10)&&e.ctrlKey){$(".answer_inpt").click()}})});var modelreplyComment=function(){var s='<div class="comment">';s+="<textarea></textarea>";s+='<div class="bbsmodelfooter"><a class="answer_inpt" style="height:30px;line-height:30px">发布</a></div></div>';addModel('回复',s);$(".bbsmodal textarea").focus();if(typeof(oremarkbtn.parents(".lireply").attr("pid"))!="undefined")$(".bbsmodal textarea").val("回复"+oremarkbtn.parents(".lireply").find("span.floor").html()+" "+oremarkbtn.parents(".lireply").find("a:eq(1)").html()+"：")};var addReply=function(){$(".bbsmodelfooter").delegate(".answer_inpt","click",function(e){e.preventDefault();var value=encodeURIComponent($(".bbsmodal").find("textarea").val()).replace(/\+/g,'%2B');if(typeof(oremarkbtn.parents(".lireply").attr("pid"))!="undefined")jsonStr="\{postID:\""+$("#postid").val()+"\",parentPostID:\""+oremarkbtn.parents(".lireply").attr("pid")+"\",ppID:\""+oremarkbtn.parents(".lireply").attr("rid")+"\", replyContent:\""+value+"\"\}";else jsonStr="\{postID:\""+$("#postid").val()+"\",parentPostID:\""+oremarkbtn.parents(".commt_entry").attr("rid")+"\",ppID:\"0\", replyContent:\""+value+"\"\}";if(value){$.ajax({type:"POST",url:"/quan/postReply.aspx/PostReply",contentType:"application/json; charset=utf-8",dataType:"json",data:jsonStr,cache:false,success:function(msg){if(eval('('+msg.d+')')[0].d=='回复成功'){var obj=eval('('+msg.d+')')[0].r;var s='<li><div class="reply_con"><div class="u_info"> <a href="/user/'+obj.UserID+'/">'+obj.NickName+'</a> <span> 发表于 '+dataTime()+'</span></div><div class="u_comment"><p> '+obj.Body+'</p></div></div></li>';oremarkbtn.parents(".commt_entry").find("ul").append(s);$(".bbsmodal").remove()}else{if(eval('('+msg.d+')')[0].d.indexOf("验证手机")>=0){popWin.showWin("310","255","验证手机","/quan/verifymobile.aspx")}else ShowMessage(eval('('+msg.d+')')[0].d)}}})}else{ShowMessage("请填写回复内容")}})};addReply();closeClick();